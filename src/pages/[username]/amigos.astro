---
import Layout from "@layout/Main.astro";
import { getProfile, getFriends } from "@services/user";
import ProfileHeader from '@components/ProfileHeader/ProfileHeader.astro';
import ProfileTabs from "@components/ProfileTabs/ProfileTabs.svelte";
import FriendsList from "@components/FriendsList/FriendsList.astro";

const { username } = Astro.params;
if (!username) return new Response(null, { status: 404 });

const session = Astro.locals.user;

const { user, messagesCount, friendsCount, pendingFriendRequest } = await getProfile({
	username,
	session,
});

if (!user) return new Response(null, { status: 404 });

const friends = await getFriends(user.id, session);

const seo = {
	title: `Amigos de ${username}`,
	description: `Fa√ßa parte da rede social Gugugram e adicione ${username} como amigo!`
}
---

<Layout {...seo}>
	<ProfileHeader {user} />
	<ProfileTabs
		selectedTab="amigos"
		{username}
		{messagesCount}
		{friendsCount}
		{pendingFriendRequest}
	>
		<FriendsList {...friends} />
	</ProfileTabs>
</Layout>
