---
import { getProfile } from "@services/user";
import { getMessages } from "@services/message";
import Layout from "@layout/Main.astro";
import ProfileHeader from "@components/ProfileHeader/ProfileHeader.astro";
import ProfileTabs from "@components/ProfileTabs/ProfileTabs.svelte";
import Messages from "@components/Messages/Messages.astro";

const { username } = Astro.params;
if (!username) return new Response(null, { status: 404 });

const session = Astro.locals.user;

const { user, messagesCount, friendsCount, pendingFriendRequest } = await getProfile({
	username,
	session,
});

if (!user) return new Response(null, { status: 404 });

const { messagesReceived } = await getMessages(user.username);

const seo = {
	title: `Recados de ${username}`,
	description: `Fa√ßa parte da rede social Gugugram e envie mensagens para ${username}!`
}
---

<Layout {...seo}>
	<ProfileHeader {user} />
	<ProfileTabs
		selectedTab="recados"
		{username}
		{messagesCount}
		{friendsCount}
		{pendingFriendRequest}
	>
		<Messages {user} messages={messagesReceived} />
	</ProfileTabs>
</Layout>
