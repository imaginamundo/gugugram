---
import { actions } from "astro:actions";
import Layout from "@layout/Main.astro";
import Input from "@ui/Input.svelte";
import Button from "@ui/Button.svelte";

const token = Astro.url.searchParams.get("token");

if (!token) {
  return Astro.redirect("/login?error=token_missing");
}

const result = Astro.getActionResult(actions.resetPassword);
if (result?.data?.success) {
	return Astro.redirect('/entrar');
}

const seo = {
	title: `Nova senha`,
	robots: 'noindex,nofollow'
}
---
<Layout {...seo}>
  <div class="form p">
    {!!result?.data?.error && (
			<p class="error mb flex center gap ">
				<img src="/icons/msg_error-0.png" alt="'Ãcone de erro" />
				{result.data.error}
			</p>
		)}
    <form method="POST" action={actions.resetPassword}>
      <input type="hidden" name="token" value={token} />
      <fieldset>
          <legend>Entrar</legend>
        <label class="label">
          Nova Senha:
          <Input type="password" autocomplete="new-password" name="newPassword" placeholder="Insira sua nova senha" required />
        </label>
        <Button class="m-sm">Atualizar senha</Button>
      </fieldset>
    </form>
  </div>
</Layout>